<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ app_name }} - API Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.24.1/themes/prism.min.css" rel="stylesheet">
    <link href="/static/css/dashboard.css" rel="stylesheet">
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">
                <strong>{{ app_name }}</strong> <span class="badge bg-light text-dark">{{ app_version }}</span>
            </a>
            <div class="navbar-nav ms-auto">
                <a class="nav-link" href="/ui/portal">Portal Dashboard</a>
                <a class="nav-link" href="/ui/test">API Tester</a>
                <a class="nav-link" href="/docs">OpenAPI Docs</a>
                <a class="nav-link" href="/redoc">ReDoc</a>
            </div>
        </div>
    </nav>

    <div class="container-fluid mt-4">
        <div class="row">
            <div class="col-12">
                <h1 class="mb-4">API Dashboard</h1>
                <p class="lead">Interactive API documentation and testing interface</p>
            </div>
        </div>

        <div class="row">
            <div class="col-md-8">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0">Available Endpoints</h5>
                    </div>
                    <div class="card-body">
                        <div id="endpoints-container">
                            {% for category, data in endpoints.items() %}
                            <div class="endpoint-category mb-4">
                                <h6 class="text-primary">{{ data.name }}</h6>
                                <p class="text-muted small">{{ data.description }}</p>
                                
                                {% for endpoint in data.endpoints %}
                                <div class="endpoint-item mb-3 p-3 border rounded">
                                    <div class="d-flex justify-content-between align-items-start">
                                        <div class="flex-grow-1">
                                            <div class="d-flex align-items-center mb-2">
                                                <span class="badge bg-{{ 'success' if endpoint.method == 'GET' else 'primary' if endpoint.method == 'POST' else 'warning' if endpoint.method == 'PUT' else 'danger' if endpoint.method == 'DELETE' else 'info' }} me-2">
                                                    {{ endpoint.method }}
                                                </span>
                                                <code class="text-dark">{{ endpoint.path }}</code>
                                            </div>
                                            <p class="mb-2">{{ endpoint.description }}</p>
                                            
                                            {% if endpoint.parameters %}
                                            <div class="parameters">
                                                <small class="text-muted">Parameters:</small>
                                                <ul class="list-unstyled small">
                                                    {% for param in endpoint.parameters %}
                                                    <li>
                                                        <code>{{ param.name }}</code> 
                                                        <span class="badge bg-{{ 'danger' if param.required else 'secondary' }} ms-1">
                                                            {{ 'required' if param.required else 'optional' }}
                                                        </span>
                                                        <span class="text-muted">({{ param.type }})</span>
                                                        {% if param.description %}
                                                        - {{ param.description }}
                                                        {% endif %}
                                                    </li>
                                                    {% endfor %}
                                                </ul>
                                            </div>
                                            {% endif %}
                                        </div>
                                        <button class="btn btn-outline-primary btn-sm" 
                                                onclick="testEndpoint('{{ endpoint.method }}', '{{ endpoint.path }}', {{ endpoint.parameters | tojson }})">
                                            Test
                                        </button>
                                    </div>
                                </div>
                                {% endfor %}
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-md-4">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0">Quick Test</h5>
                    </div>
                    <div class="card-body">
                        <form id="quick-test-form">
                            <div class="mb-3">
                                <label for="test-endpoint" class="form-label">Select Endpoint</label>
                                <select class="form-select" id="test-endpoint" onchange="loadEndpointForm()">
                                    <option value="">Choose an endpoint...</option>
                                    <optgroup label="Health Endpoints">
                                        <option value="GET:/api/v1/health/">Health Check</option>
                                        <option value="GET:/api/v1/health/ready">Readiness Check</option>
                                        <option value="GET:/api/v1/health/live">Liveness Check</option>
                                    </optgroup>
                                    <optgroup label="User Endpoints">
                                        <option value="GET:/api/v1/users/{user_id}/profile">Get User Profile</option>
                                        <option value="GET:/api/v1/users/{user_id}/location">Get User Location</option>
                                        <option value="GET:/api/v1/users/{user_id}/interactions">Get User Interactions</option>
                                        <option value="POST:/api/v1/users/{user_id}/process-comprehensive">Process User</option>
                                        <option value="POST:/api/v1/users/{user_id}/generate-recommendations">Generate Recommendations</option>
                                        <option value="GET:/api/v1/users/{user_id}/results">Get User Results</option>
                                    </optgroup>
                                    <optgroup label="Root Endpoints">
                                        <option value="GET:/">Root Info</option>
                                        <option value="GET:/ping">Ping Test</option>
                                    </optgroup>
                                </select>
                            </div>
                            
                            <div id="endpoint-form" style="display: none;">
                                <div class="mb-3">
                                    <label for="test-user-id" class="form-label">User ID (for user endpoints)</label>
                                    <input type="text" class="form-control" id="test-user-id" 
                                           placeholder="Enter user ID (e.g., user123)" value="user123">
                                </div>
                                
                                <div class="mb-3" id="priority-field" style="display: none;">
                                    <label for="test-priority" class="form-label">Priority (1-10)</label>
                                    <input type="number" class="form-control" id="test-priority" 
                                           min="1" max="10" value="5">
                                </div>
                                
                                <div class="mb-3" id="category-field" style="display: none;">
                                    <label for="test-category" class="form-label">Category Filter</label>
                                    <select class="form-select" id="test-category">
                                        <option value="">All Categories</option>
                                        <option value="movies">Movies</option>
                                        <option value="music">Music</option>
                                        <option value="places">Places</option>
                                        <option value="events">Events</option>
                                    </select>
                                </div>
                                
                                <div class="mb-3" id="limit-field" style="display: none;">
                                    <label for="test-limit" class="form-label">Results Limit</label>
                                    <input type="number" class="form-control" id="test-limit" 
                                           min="1" max="50" value="5">
                                </div>
                                
                                <div class="mb-3" id="min-score-field" style="display: none;">
                                    <label for="test-min-score" class="form-label">Minimum Score</label>
                                    <input type="number" class="form-control" id="test-min-score" 
                                           min="0" max="1" step="0.1" value="0.0">
                                </div>
                                
                                <div class="mb-3" id="prompt-field" style="display: none;">
                                    <label for="test-prompt" class="form-label">Custom Prompt (optional)</label>
                                    <textarea class="form-control" id="test-prompt" rows="3" 
                                              placeholder="Leave empty to use default prompt"></textarea>
                                </div>
                            </div>
                            
                            <button type="submit" class="btn btn-primary w-100" id="submit-btn" disabled>Send Request</button>
                        </form>
                    </div>
                </div>

                <div class="card mt-3">
                    <div class="card-header">
                        <h5 class="mb-0">Response</h5>
                    </div>
                    <div class="card-body">
                        <div id="response-container">
                            <p class="text-muted">No response yet. Send a request to see the result.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.24.1/components/prism-core.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.24.1/plugins/autoloader/prism-autoloader.min.js"></script>
    <script src="/static/js/dashboard.js"></script>
</body>
</html>
